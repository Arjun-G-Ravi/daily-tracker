{% extends "base.html" %}

{% block content %}
<div class="month-header">
    <a href="{{ url_for('home', year=prev_year, month=prev_month) }}" class="nav-arrow">‹</a>
    <a href="{{ url_for('home') }}" class="month-title">{{ month_name }} {{ year }}</a>
    <a href="{{ url_for('home', year=next_year, month=next_month) }}" class="nav-arrow">›</a>
</div>

<!-- Add Journey Form -->
<div class="add-journey-form">
    <!-- Add Journey Template Form (without date) -->
    <form method="POST" action="{{ url_for('add_template') }}" class="inline-form">
        <input type="text" name="journey_name" placeholder="Add new journey..." required>
        <button type="submit" class="btn btn-small">Add Journey</button>
    </form>
    
    <div style="display: flex; gap: 10px;">
        <a href="{{ url_for('journeys') }}" class="btn btn-secondary btn-small">View All Journeys</a>
        <button type="button" id="reorderBtn" class="btn btn-small btn-secondary">Reorder</button>
    </div>
</div>

<div class="calendar-container">
    <table class="calendar-table">
        <thead>
            <tr>
                <th class="journey-name">Journey</th>
                {% for day in range(1, 32) %}
                <th>{{ day }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody id="journeyTableBody">
            {% for journey in all_journeys %}
            <tr class="journey-row" data-journey="{{ journey }}">
                <td class="journey-name">
                    <span class="drag-handle" style="display: none; cursor: move; margin-right: 5px;">⋮⋮</span>
                    <a href="{{ url_for('journey_detail', journey_name=journey) }}" class="journey-link">
                        {{ journey }}
                    </a>
                </td>
                {% for day in range(1, 32) %}
                {% set date_key = "{}-{:02d}-{:02d}".format(year, month, day) %}
                <td>
                    {% if day <= days_in_month %}
                    {% set is_completed = journeys.get(date_key, {}).get(journey) %}
                    {% set is_missed = day in missed_days.get(journey, []) %}
                    {% set is_scheduled = day in scheduled_days.get(journey, []) %}
                    
                    {% if settings.display_mode == 'schedule' %}
                        <div class="day-cell 
                             {% if is_completed %}completed
                             {% elif not is_scheduled %}unscheduled
                             {% endif %}"
                             title="{{ journey }} - {{ day }}/{{ month }}"
                             data-journey="{{ journey }}"
                             data-day="{{ day }}"
                             data-month="{{ month }}"
                             data-year="{{ year }}">
                        </div>
                    {% else %}
                        <div class="day-cell 
                             {% if is_completed %}completed
                             {% elif is_missed %}missed
                             {% endif %}"
                             title="{{ journey }} - {{ day }}/{{ month }}{% if is_missed %} (Missed){% endif %}"
                             data-journey="{{ journey }}"
                             data-day="{{ day }}"
                             data-month="{{ month }}"
                             data-year="{{ year }}">
                        </div>
                    {% endif %}
                    {% else %}
                    <div class="day-cell invalid-day" title="Invalid date">
                    </div>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
            
            {% if not all_journeys %}
            <tr>
                <td colspan="32" style="text-align: center; padding: 40px; color: #8b949e;">
                    No journeys yet. Add your first journey above!
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}
